"use strict";(self.webpackChunktkbook=self.webpackChunktkbook||[]).push([[8817],{1332:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});var s=i(4848),a=i(8453);const o={},r=void 0,t={id:"Libraries/Liquibase",title:"Liquibase",description:"Here's a structured version of the provided information, condensed to follow DRY (Don\u2019t Repeat Yourself) principles:",source:"@site/docs/Libraries/Liquibase.md",sourceDirName:"Libraries",slug:"/Libraries/Liquibase",permalink:"/tk_book/Libraries/Liquibase",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Apache Poi",permalink:"/tk_book/Libraries/Apache Poi"},next:{title:"Dependency Management in Java Projects",permalink:"/tk_book/Security/Dependencies"}},c={},l=[{value:"Connection Options",id:"connection-options",level:3},{value:"How Liquibase Works",id:"how-liquibase-works",level:2},{value:"Running Commands",id:"running-commands",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Integrating Liquibase with Tumorotek",id:"integrating-liquibase-with-tumorotek",level:2},{value:"Maven Configuration",id:"maven-configuration",level:3},{value:"Example: Introducing a New Table",id:"example-introducing-a-new-table",level:3},{value:"Best Practices",id:"best-practices",level:2}];function d(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Here's a structured version of the provided information, condensed to follow DRY (Don\u2019t Repeat Yourself) principles:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-markdown",children:"# Liquibase\n\nLiquibase is an open-source library for managing and applying database schema changes across environments in a systematic and version-controlled manner. It supports various formats (XML, YAML, JSON, SQL) for defining changes and ensures reliable deployments with rollback and audit capabilities.\n\n## Key Benefits\n\n- **Schema Version Control:** Tracks all schema modifications\n- **Automated Updates:** Minimizes human error by automating schema deployments\n- **Consistency Across Environments:** Ensures dev, test, and production have identical schemas\n- **Rollback Support:** Enables safe reversion of changes\n- **Audit Compliance:** Maintains an audit trail of changes\n\n## Core Concepts\n\n### Changelog Files\nA changelog file defines the database modifications in a series of atomic units called **changesets**. Common commands include `<createTable>`, `<addColumn>`, and `<sql>`. Changesets support **preconditions** for environment validation and **contexts/labels** to control when they execute.\n\n### Database Tables\nLiquibase uses two primary tables to track changes:\n- **`DATABASECHANGELOG`**: Stores records of applied changes\n- **`DATABASECHANGELOGLOCK`**: Prevents concurrent modifications\n\n## Configuration\n\n### Basic Setup\nTo configure Liquibase for your Tumorotek project, edit `tumorotek-webapp/src/main/resources/liquibase/liquibase.properties`:\n\n```properties\nurl=jdbc:mysql://localhost:3306/your_database\nusername=your_username\npassword=your_password\n"})}),"\n",(0,s.jsx)(n.h3,{id:"connection-options",children:"Connection Options"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Properties File"}),": Configure the database URL and credentials in a ",(0,s.jsx)(n.code,{children:"properties"})," file."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Changelog File"}),": For environment-specific setups, you can define connection details directly in the changelog file."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-liquibase-works",children:"How Liquibase Works"}),"\n",(0,s.jsx)(n.p,{children:"Liquibase applies database changes by reading the changelog file and updating the database according to pending changes:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lock Verification"}),": Checks ",(0,s.jsx)(n.code,{children:"DATABASECHANGELOGLOCK"})," for other active processes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Changelog Processing"}),": Reads the changelog and validates each change."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Change Application"}),": Executes pending changes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Record Keeping"}),": Updates ",(0,s.jsx)(n.code,{children:"DATABASECHANGELOG"})," with applied changes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lock Release"}),": Clears ",(0,s.jsx)(n.code,{children:"DATABASECHANGELOGLOCK"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"running-commands",children:"Running Commands"}),"\n",(0,s.jsxs)(n.p,{children:["To run Liquibase, ensure that the ",(0,s.jsx)(n.code,{children:"liquibase.properties"})," file has correct database configurations. Then, you can execute commands such as:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"liquibase update\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you encounter a lock error, check and release it with:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM DATABASECHANGELOGLOCK WHERE ID = 1;\n\nUPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKGRANTED = NULL, LOCKEDBY = NULL WHERE ID = 1;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Lock Errors"}),": Check the ",(0,s.jsx)(n.code,{children:"DATABASECHANGELOGLOCK"})," table. Release a lock with the ",(0,s.jsx)(n.code,{children:"UPDATE"})," query above."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Re-running Changes"}),": To force rerun, delete the specific changeset entry in ",(0,s.jsx)(n.code,{children:"DATABASECHANGELOG"})," and execute ",(0,s.jsx)(n.code,{children:"liquibase update"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"integrating-liquibase-with-tumorotek",children:"Integrating Liquibase with Tumorotek"}),"\n",(0,s.jsx)(n.h3,{id:"maven-configuration",children:"Maven Configuration"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"tumorotek-webapp"}),": Contains the Liquibase execution configurations."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"tumorotek-model"}),": Manages version-specific behavior and schema definitions."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example-introducing-a-new-table",children:"Example: Introducing a New Table"}),"\n",(0,s.jsxs)(n.p,{children:["To create a new table, ",(0,s.jsx)(n.code,{children:"PARAMETRE_VALEUR_SPECIFIQUE"}),", use the following format:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"\n                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog\n                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.10.xsd">\n\n    <changeSet author="your_author_name" id="createTable_PARAMETRE_VALEUR_SPECIFIQUE">\n        <createTable tableName="PARAMETRE_VALEUR_SPECIFIQUE">\n            <column name="parameterId" type="INT">\n                <constraints primaryKey="true" nullable="false"/>\n            </column>\n            \x3c!-- Add other columns as needed --\x3e\n        </createTable>\n    </changeSet>\n\n</databaseChangeLog>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Use descriptive changeset IDs and authors."}),"\n",(0,s.jsx)(n.li,{children:"Include rollback instructions where possible."}),"\n",(0,s.jsx)(n.li,{children:"Test changes in development environments before production."}),"\n",(0,s.jsx)(n.li,{children:"Maintain clear documentation of all changes."}),"\n",(0,s.jsx)(n.li,{children:"Use contexts to apply environment-specific changes only when needed."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>t});var s=i(6540);const a={},o=s.createContext(a);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);