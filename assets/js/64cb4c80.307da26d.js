"use strict";(self.webpackChunktkbook=self.webpackChunktkbook||[]).push([[8817],{1332:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});var s=i(4848),a=i(8453);const r={},o="Liquibase",t={id:"Libraries/Liquibase",title:"Liquibase",description:"Liquibase is an open-source database-independent library for tracking, managing, and applying database schema changes. It allows you to version control your database schema, making it easier to deploy.",source:"@site/docs/Libraries/Liquibase.md",sourceDirName:"Libraries",slug:"/Libraries/Liquibase",permalink:"/tk_book/docs/Libraries/Liquibase",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Apache Poi",permalink:"/tk_book/docs/Libraries/Apache Poi"},next:{title:"Security Audit",permalink:"/tk_book/docs/Security/Sescurity Audit"}},l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Problems Liquibase Solves",id:"problems-liquibase-solves",level:2},{value:"How Liquibase Works",id:"how-liquibase-works",level:2},{value:"Tables Created for Changelog",id:"tables-created-for-changelog",level:2},{value:"Running a Changelog Twice",id:"running-a-changelog-twice",level:2},{value:"Configuring Liquibase",id:"configuring-liquibase",level:2},{value:"Resolving Commend Error",id:"resolving-commend-error",level:2},{value:"How Liquibase Works",id:"how-liquibase-works-1",level:2},{value:"Changelog File",id:"changelog-file",level:3},{value:"Changesets",id:"changesets",level:3},{value:"Commands",id:"commands",level:3},{value:"Database Connection",id:"database-connection",level:3},{value:"Execution",id:"execution",level:3},{value:"Setting up Liquibase Configuration",id:"setting-up-liquibase-configuration",level:2},{value:"Defining Datasource in Liquibase",id:"defining-datasource-in-liquibase",level:2},{value:"Using Liquibase in TK Project",id:"using-liquibase-in-tk-project",level:2},{value:"Force Rerun of Changeset",id:"force-rerun-of-changeset",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"liquibase",children:"Liquibase"})}),"\n",(0,s.jsx)(n.p,{children:"Liquibase is an open-source database-independent library for tracking, managing, and applying database schema changes. It allows you to version control your database schema, making it easier to deploy."}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"Liquibase is an open-source database schema change management tool that helps manage and track database changes in a consistent and controlled manner. It provides a way to define, manage, and apply changes to a database schema, ensuring that the schema remains synchronized across different environments and teams."}),"\n",(0,s.jsx)(n.h2,{id:"problems-liquibase-solves",children:"Problems Liquibase Solves"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Schema Version Control:"})," Liquibase allows versioning of database schemas, ensuring that changes are tracked and can be rolled back if necessary. This is especially important in environments where multiple developers or teams are working on the same database."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Automated Database Updates:"})," It automates the process of applying changes to the database, reducing the risk of human error and ensuring that all changes are applied in the correct order."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Environment Consistency:"})," By using Liquibase, you can ensure that the database schema remains consistent across different environments (development, testing, production), reducing issues that arise from schema differences."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rollback Capability:"})," Liquibase supports rolling back changes, allowing you to revert to a previous state if something goes wrong."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auditing and Compliance:"})," It provides a detailed history of changes made to the database, which is useful for auditing and compliance purposes."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-liquibase-works",children:"How Liquibase Works"}),"\n",(0,s.jsx)(n.p,{children:'Liquibase operates using a concept called a "changelog," which is a file or a set of files that define the changes to be made to the database schema. These files are written in XML, YAML, JSON, or SQL. The main components of Liquibase are:'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Changelog Files:"}),' These files contain the instructions for modifying the database schema. Each change is defined as a "changeSet," which is a unit of change that includes a unique identifier, author, and the actual change to be applied.']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DatabaseChangeLog Table:"})," Liquibase creates and maintains a special table in the database called DATABASECHANGELOG to keep track of which changes have been applied. This table records the unique ID, author, and filename of each changeSet that has been executed."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DatabaseChangeLogLock Table:"})," This table (DATABASECHANGELOGLOCK) is used to ensure that only one instance of Liquibase is modifying the database at a time, preventing conflicts and ensuring consistency."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When Liquibase runs, it performs the following steps:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Checks the Lock: It checks the DATABASECHANGELOGLOCK table to ensure no other process is running."}),"\n",(0,s.jsx)(n.li,{children:"Reads the Changelog: It reads the changelog file(s) to determine what changes need to be applied."}),"\n",(0,s.jsx)(n.li,{children:"Applies Changes: It applies the necessary changes to the database."}),"\n",(0,s.jsx)(n.li,{children:"Records Changes: It records each applied changeSet in the DATABASECHANGELOG table."}),"\n",(0,s.jsx)(n.li,{children:"Releases Lock: It releases the lock in the DATABASECHANGELOGLOCK table."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"tables-created-for-changelog",children:"Tables Created for Changelog"}),"\n",(0,s.jsx)(n.p,{children:"Liquibase creates two tables in the database:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DATABASECHANGELOG"}),": Records each changeSet applied including metadata fields like unique ID, author, filename executed date etc."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DATABASECHANGELOGLOCK"}),": Manages access preventing simultaneous modifications by multiple instances."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"running-a-changelog-twice",children:"Running a Changelog Twice"}),"\n",(0,s.jsx)(n.p,{children:"By design Liquibase avoids reapplying changeSets but when needed (e.g., development environment) there are ways around this issue:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Using contexts"}),"\n",(0,s.jsx)(n.li,{children:"Using labels"}),"\n",(0,s.jsx)(n.li,{children:"Using preconditions"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuring-liquibase",children:"Configuring Liquibase"}),"\n",(0,s.jsxs)(n.p,{children:["To work with Liquibase and run Liquibase commands, you need to edit the ",(0,s.jsx)(n.code,{children:"tumorotek-webapp/src/main/resources/liquibase/liquibase.properties"})," file. Update the following properties:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"url"}),": the URL for tk database"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"username"}),": MySQL username"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"password"}),": MySQL password"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"resolving-commend-error",children:"Resolving Commend Error"}),"\n",(0,s.jsx)(n.p,{children:'If you encounter an error while running the update command like "Could not acquire change log lock. Currently locked by xxx since yyy," follow these steps:'}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Run this query to see the problem:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM DATABASECHANGELOGLOCK WHERE ID = 1;\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Release the lock by running:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"UPDATE DATABASECHANGELOGLOCK SET LOCKED = 0, LOCKGRANTED = NULL, LOCKEDBY = NULL WHERE ID = 1;\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-liquibase-works-1",children:"How Liquibase Works"}),"\n",(0,s.jsx)(n.h3,{id:"changelog-file",children:"Changelog File"}),"\n",(0,s.jsx)(n.p,{children:"Liquibase uses a changelog file (usually in XML, YAML, or SQL format) to define database changes.\nThe changelog file contains a set of changesets, each representing a specific database change."}),"\n",(0,s.jsx)(n.h3,{id:"changesets",children:"Changesets"}),"\n",(0,s.jsx)(n.p,{children:"Changesets are units of change within the changelog file.\nEach changeset describes a specific database change using a set of commands."}),"\n",(0,s.jsx)(n.h3,{id:"commands",children:"Commands"}),"\n",(0,s.jsxs)(n.p,{children:["Liquibase commands define specific database operations such as creating a table, adding a column, or inserting data.\nCommon commands include ",(0,s.jsx)(n.code,{children:"<createTable>"}),", ",(0,s.jsx)(n.code,{children:"<addColumn>"}),", ",(0,s.jsx)(n.code,{children:"<modifyColumn>"}),", ",(0,s.jsx)(n.code,{children:"<sql>"}),", etc."]}),"\n",(0,s.jsx)(n.h3,{id:"database-connection",children:"Database Connection"}),"\n",(0,s.jsx)(n.p,{children:"Liquibase requires information about the database connection to apply changes.\nConnection details (URL, username, password) are usually specified in a properties file or directly in the changelog file."}),"\n",(0,s.jsx)(n.h3,{id:"execution",children:"Execution"}),"\n",(0,s.jsx)(n.p,{children:"Liquibase can be executed from the command line, integrated into build tools (Maven, Gradle), or used programmatically.\nWhen Liquibase runs, it checks the database for its change history and applies pending changes."}),"\n",(0,s.jsx)(n.h2,{id:"setting-up-liquibase-configuration",children:"Setting up Liquibase Configuration"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Install Liquibase"}),": Download it from the official website or use Maven or Gradle dependency management."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Database Configuration"}),": Configure your database connection details in either a properties file or directly in the changelog file."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Changelog File"}),": Create a changelog file to define your database changes."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"defining-datasource-in-liquibase",children:"Defining Datasource in Liquibase"}),"\n",(0,s.jsx)(n.p,{children:"You can define the database connection information using either a properties file or directly in the changelog file:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Using Properties File"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Create a ",(0,s.jsx)(n.code,{children:"liquibase.properties"})," file with your connection details."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-properties",children:"url=jdbc:mysql://localhost:3306/dev_tumo?useSSL=false&createDatabaseIfNotExist=true&characterEncoding=UTF-8&rewriteBatchedStatements=true&serverTimezone=Europe/Paris\nusername=your_username\npassword=your_password\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Directly in Changelog File"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Define connection details within the changelog XML using attributes like ",(0,s.jsx)(n.code,{children:"url"}),", ",(0,s.jsx)(n.code,{children:"username"}),", and ",(0,s.jsx)(n.code,{children:"password"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"using-liquibase-in-tk-project",children:"Using Liquibase in TK Project"}),"\n",(0,s.jsx)(n.p,{children:"In TK project's pom.xml files:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"tumorotek-webapp"})," plugin configuration sets up Liquibase execution during Maven build process."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"tumorotek-model"})," ignores certain goals of Liquibasen based on version range."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"force-rerun-of-changeset",children:"Force Rerun of Changeset"}),"\n",(0,s.jsx)(n.p,{children:"If you need to force rerun of specific changeset due to configurations:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Identify Changeset: Find ID and AUTHOR of desired changeset."}),"\n",(0,s.jsx)(n.li,{children:"Delete from DATABASECHANGELOG: Remove corresponding record using SQL DELETE statement."}),"\n",(0,s.jsx)(n.li,{children:"Run Liquibse: After deletion, run Liquibse again for reapplication of changeset during Maven build process."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This is an overview; adjust processes based on your requirements and databases supported by Liquibae features like rollbacks and preconditions for effective management of database schema changes."})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>t});var s=i(6540);const a={},r=s.createContext(a);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);